{"version":3,"file":"index.js","sources":["../src/template.jsx","../src/toposort.ls","../src/index.ls"],"sourcesContent":["export default h => ({\n  title, name=title, styles, scripts,\n  content: Content='', rootAttributes={id: 'root'},\n  lang=\"en\", themeColor=\"#000\", manifest=\"/manifest.json\", favicon=\"/favicon.png\"\n}) =>\n<html lang={lang}>\n\n<head>\n  <title>{name}</title>\n  <meta charset=\"utf-8\" />\n  <meta name=\"mobile-web-app-capable\" content=\"yes\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <meta name=\"theme-color\" content={themeColor} />\n  <meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\n  <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\" />\n  <link rel=\"manifest\" href={manifest} />\n  <link rel=\"shortcut icon\" href={favicon} />\n  {styles.map(href =>\n    <link rel=\"stylesheet\" href={href} />\n  )}\n</head>\n\n<body>\n  <div {...rootAttributes}>\n    {typeof(Content) == 'string'? Content: <Content />}\n  </div>\n  {scripts.map(src =>\n    <script src={src}></script>\n  )}\n</body>\n\n</html>\n","function toposort nodes\n  deps = {}\n  Object.values nodes .for-each (parents) ->\n    parents.for-each (id) -> deps[id] := (deps[id] || 0) + 1\n  start = Object.keys nodes .filter (-> !(it of deps))\n  cut = ->\n    head = nodes[it]map (id) ->\n      deps[id] -= 1\n      if deps[id] == 0 then cut id else []\n    []concat it, ...head\n  []concat ...start.map cut .reverse!\n\nexport default: toposort\n","import\n  \\./template : default-template\n  \\./toposort : toposort\n\nfunction create-template component\n  {h} = require \\preact\n  render-string = require \\preact-render-to-string\n  -> '<!DOCTYPE html>\\n' + render-string (component h) it\n\nfunction webpack-asset source\n  source: -> source\n  size: -> source.length\n\nfunction manifest {chunk-groups, assets} {prefix=\\/}\n  #TODO cases to generate groups\n  nodes = Object.assign ...chunk-groups.map ->\n    (it.id): it.get-parents!map (.id)\n  group-ref = Object.assign ...chunk-groups.map -> (it.id): it\n  sorted-groups = toposort nodes .map (group-ref.)\n  file-list = []concat ...sorted-groups.map ->\n    []concat ...it.chunks.map (.files)\n  merged = Object.assign {} assets, ...file-list.map -> (it): true\n  list = Object.keys merged .map -> prefix + it\n  styles: list.filter /.css$/~test\n  scripts: list.filter /.js$/~test\n\nfunction generate compilation, {filename=\\index.html}: options\n  props = Object.assign {compilation} (manifest compilation, options), options\n  render-template = create-template default-template\n  (filename): webpack-asset render-template props\n\n!function HtmlPlugin options\n  @options = options\n\nHtmlPlugin::apply = (compiler) ->\n  compiler.hooks.emit.tap \\html-plugin ({assets}: compilation) ~>\n    Object.assign assets, generate compilation, @options\n\nmodule.exports = HtmlPlugin\n"],"names":["h","title","Content","lang","name","themeColor","manifest","favicon","styles","map","href","rootAttributes","scripts","src"],"mappings":"AAAA,uBAAeA,KAAK,CAAC;OAAA;SACPC,KADO;QAAA;SAAA;WAEVC,UAAQ,EAFE;mBAEiB;QAAK;GAFtB;SAGd,IAHc;eAGG,MAHH;aAGoB,gBAHpB;YAG8C;CAH/C,KAKpB;QAAYC;GAEZ,gBACE,iBAAQC,IAAR,CADF,EAEE;WAAc;EAFhB,EAGE;QAAW,wBAAX;WAA4C;EAH9C,EAIE;QAAW,UAAX;WAA8B;EAJhC,EAKE;QAAW,aAAX;WAAkCC;EALpC,EAME;QAAW,8BAAX;WAAkD;EANpD,EAOE;QAAW,uCAAX;WAA2D;EAP7D,EAQE;OAAU,UAAV;QAA2BC;EAR7B,EASE;OAAU,eAAV;QAAgCC;EATlC,EAUGC,OAAOC,GAAP,CAAWC,QACV;OAAU,YAAV;QAA6BA;EAD9B,CAVH,CAFA,EAiBA,gBACE,SAASC,cAAT,EACG,OAAOT,OAAP,IAAmB,QAAnB,GAA6BA,OAA7B,GAAsC,EAAC,OAAD,OADzC,CADF,EAIGU,QAAQH,GAAR,CAAYI,OACX;OAAaA;EADd,CAJH,CAjBA,CALA;;ACAA,yBACE;;SAAO,EAAP;eACc,OAAM,QAAU,oBAC5B;WAAO,eAAU,eAAK;aAAO,QAAJ,GAA4B,CAAX,QAAK,KAAM;KAApC;GADW;UAEhB,WAAM,OAAM,OAAQ,CAAC;WAAG,EAAE,UAAF;GAAJ,CAAlC;;QACM,cACJ;;WAAY,SAAI,IAAI,eAClB;cAAA;aACO,QAAK,SAAc,UAAQ;KAFhB,CAApB;WAGA,EAAE,OAAO,KAAI,OAAJ;GAJX;;SAKA,EAAE,OAAO,IAAQ,SAAK,KAAb,CAAiB,QAAQ;;;ACNpC,mCACE;;;;MAAc,iBAAd;iBACwB,kCAAxB;SACA;WAAuB,sBAAgB,aAAW,YAAG,IAAd;;;;AAEzC,8BACE;SAAA;YAAQ;;KAAR;UACM;aAAS;;;;;AAEjB,kBAAkB;aAAA;;CAAlB,EAAyC;;CAAzC,EAEE;;;;UAAc,aAAQ,IAAe,eAAK,eACxC;WAAA;OAAG,KAAH,GAAW,aAAY,EAAC,IAAI,CAAC,WAAD;;GADY,CAApB,CAAtB;aAEkB,aAAQ,IAAe,eAAK;WAAG;OAAG,KAAH;;GAAH,CAApB,CAA1B;iBACyB,eAAM,IAAK,CAAU,kBAAV,CAApC;aACY,EAAE,OAAO,IAAgB,gBAAK,eACxC;WAAA,EAAE,OAAO,IAAK,SAAO,IAAK,CAAC,cAAD,CAAjB;GAD+B,CAArB,CAArB;WAEe,aAAQ,aAAW,GAAY,YAAK;WAAG;;;GAAH,CAA5B,CAAvB;SACa,WAAM,QAAO,IAAK;WAAU;GAAV,CAA/B;SACA;YAAY,WAAQ,CAAO,yBAAP,gBAApB;aACa,WAAQ,CAAM,wBAAN;;;;AAEvB,wCACE;;GAD6B;;;UACf,aAAQ;;KAAwB,8BAAxB,UAAtB;mBACkC,+BAAlC;SACA;gBAA0B,aAAgB,qBAAhB;;;;AAE5B,6BACE;cAAA;;;AAEQ,oBAAE,MAAZ,GAAoB,oBAClB;SAAQ,cAAM,KAAK,IAAK,gBAAa,eACnC;;KADoC;;;WAC9B,aAAQ,SAAiB,sBAAc,YAAd,CAAjB;GADQ;CAD1B;;AAIM,cAAN"}